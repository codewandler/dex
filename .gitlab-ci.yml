stages:
  - build

build:
  stage: build
  image: golang:1.23
  parallel:
    matrix:
      - GOOS: linux
        GOARCH: [amd64, arm64]
      - GOOS: darwin
        GOARCH: [amd64, arm64]
      - GOOS: windows
        GOARCH: amd64
  script:
    - |
      EXT=""
      if [ "$GOOS" = "windows" ]; then
        EXT=".exe"
      fi
      go build -ldflags "-X main.Version=${CI_COMMIT_TAG:-${CI_COMMIT_SHORT_SHA}}" \
        -o bin/dex-${GOOS}-${GOARCH}${EXT} .
  artifacts:
    paths:
      - bin/
